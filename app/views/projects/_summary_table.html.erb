
<div class="row-fluid">
  <div class="span12 well">

    <!-- table column names -->
    <div class="row-fluid pagination-centered">
      <div class="span5">
        <h4>Project Name</h4>
      </div>
      <div class="span4">
        <h4>Schools Required</h4>
      </div>
      <div class="span1">
      </div>
      <div class="span2">
        <h4>Status</h4>
      </div>
    </div>

    <!-- table column hints -->
    <div class="row-fluid pagination-centered">
      <div class="span5">
      </div>
      <div class="span4">
        <table class="table_no_decor"><tr class="table_no_decor">
            <% School.all.each do |s| %>
              <td style="width: 25%;"><h6><%= "#{s.name}" %></h6></td>
            <% end %>
        </table></tr>
      </div>
      <div class="span1">
      </div>
      <div class="span2">
      </div>
    </div>


    <!-- rows for projects -->
    <% projects.each do |project| %>
      <div class="row-fluid" style="margin: 7px 0px">

        <!--
        Project name
        -->
        <div class="span5">
          <%= render :partial => "projects/details_popover", :locals => {project: project, level: 1} %>
        </div>

        <!--
        Project school details
        -->
        <div class="span4">
          <table class="table_no_decor"><tr class="table_no_decor">
              <% School.all.each do |s| %>
                <% if project.schools.include?(s) %>
                  <td style="width: 25%; text-align: center;"><%= "*" %></td>
                <% else %>
                  <td></td>
                <% end %>
              <% end %>
          </table></tr>
        </div>

        <div class="span1">
        </div>

        <!-- 
        1. Display "Assigned" if project has already been assigned
        -->
        <% if project.group %>

          <div class="span2 pagination-centered">

            <a      
              href="#"
              id="<%= "assigned_group_info_#{project.group.id}" %>"  
              data-trigger="hover" 
              data-original-title="Group Info"
              data-placement="bottom"
              rel="popover" 
              onclick="return false;">
              <span class="label label-info">Assigned</span>
            </a>

            <div id="<%= "assigned_group_info_#{project.group.id}_content" %>" style="display: none;">
              <div class="row-fluid">
                <div class="span12">
                  <%= render :partial => "groups/details", :locals => {group: project.group} %>
                </div>
              </div>
            </div>

          </div>

        <% else %>
          <!-- 
          1. Display link to edit proposal if proposal exists
          2. Display link to submit proposal if project is available
          -->
          <% if current_user.isStudent? and current_user.is_owner? %>
            <div class="span1 pagination-centered">
              <% submitted_proposals = Proposal.where(project_id: project.id, group_id: current_user.my_group.id) %>

              <% if submitted_proposals.count > 0 %>
                <a 
                  href="<%= proposal_path(submitted_proposals[0]) %>"
                  rel="tooltip" 
                  data-toggle="tooltip" 
                  data-placement="top" 
                  title="" 
                  data-original-title="View your proposal">
                  <%= image_tag "proposal_submitted.png", class: "medium_icon" %>
                </a>

              <% elsif current_user.my_group.available_project_choices.include? project %>
                <a 
                  href="<%= new_proposal_path(project: project.id) %>"
                  rel="tooltip" 
                  data-toggle="tooltip" 
                  data-placement="top" 
                  title="" 
                  data-original-title="Submit new proposal">
                  <%= image_tag "can_submit_proposal.png", class: "medium_icon" %>
                </a>

              <% end %>
            </div>
          <% end %>

          <!--
          1. Should a count of the number of proposals submitted
          2. On hover, if count != 0, show a list of groups that submitted proposals
          -->
          <div class="span1 pagination-centered">
            <% proposal_count = project.proposals.count %>

            <% if proposal_count == 0 %>
              <span class="badge"><%= proposal_count %></span>
            <% else %>
              <a      
                href="#"
                id="<%= "list_of_proposals_projid_#{project.id}" %>"  
                data-trigger="hover" 
                data-original-title="Groups that submitted proposals"
                data-placement="bottom"
                rel="popover" 
                onclick="return false;">
                <span class="badge"><%= proposal_count %></span>
              </a>

              <div id="<%= "list_of_proposals_projid_#{project.id}_content" %>" style="display: none;">
                <div class="row-fluid">
                  <div class="span12">
                    <ul>
                      <% project.proposals.each do |p| %>
                        <li class="bullet"><%= p.group.name %></li>
                      <% end %>
                    </ul>
                  </div>
                </div>
              </div>  
            <% end %>

          </div>
        <% end %>

      </div>
    <% end %>

  </div>
</div>


